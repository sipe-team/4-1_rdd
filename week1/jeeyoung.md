### 서버스펙:

- kotlin 1.9.x, Spring 3.2.x, java 21
- 모놀리식 아키텍처
- PostgreSql

## 1. API Request History Bulk insert 로 변환하기

### 현 시스템

- 사내에 api 요청 정보를 RDBS에 저장하는 기능이 있음
- 로그는 메인 로직 실패 여부와 상관없이 반드시 저장됨
- 기본 정책은 변경 요청시(POST,PUT,PATCH,DELETE) 무조건 저장, GET 요청시 선별 저장임
- 저장되는 데이터: url, method, params, body, ip, id 값
- 해당 저장 로직은 블록킹 비동기로 되어있으며 별도의 스레드풀을 사용하고 있음.
- api 요청 정보 실시간 확인이 필요 없는 데이터임

### 문제

- 데이터 변경 요청시 최소 2번의 DB 접근이 일어남
- 같은 데이터 커넥션풀을 점유하기 때문에, 트래픽이 몰리면 커넥션 고갈 문제 및 스레드 병목 현상이 발생할 수 있음.

### 개선 목표

- 서드파티 로깅 시스템은 사용 불가능 → 현 RDBMS 구조 유지
- 전역 큐를 만들어 해당 큐가 차거나 특정 시간이 지나면 bulk insert 하는 방식으로 변경
- 전역 큐는 메모리 기반이기 때문에 서버 재시작시 유실될 수 있음. 해당 부분은 서버가 종료되기 전 저장하도록  추가가 필요함


## 2. 엑셀 다운로드 성능 개선하기

### 문제

- 500KB의  총 5,000건 엑셀 다운로드시 약 5초가 걸림
- 엑셀 다운로드 버튼 클릭시 JVM Heap Memory 사용량이 300MB 이상 급증
- 데이터에 양에 비해 비정상적인 서버 점유율, 동시 요청시 OOM 발생

### 개선 목표

- 엑셀 다운로드 전반적인 성능 개선
- Resilience4j의 BulkHead 패턴 도입 및 처리율을 제한하여 동시 요청 수 제어
- ThreadPoolBulkhead 사용 예정
