# 테스트 기반 리팩토링

## 목표

- 복잡성이 높고 에러 가능성이 높은 컴포넌트에 대해서 선 테스트 작성 - 후 리팩토링의 방식으로 리팩토링을 수행한다.
- 리팩토링을 통해 실질적 성능 개선 또는 유지보수성 향상을 달성한다.

## 기대 효과

- 리팩토링으로 인한 사이드 이펙트를 방지할 수 있다.
- 수동 테스트에 드는 시간이 절감된다.
- 추후 기능 요구사항 변동으로 인한 예기치 못한 에러 발생을 방지할 수 있다.

## 대상 범위

### 배출량 리스트 컴포넌트

- 기능 요약

이 컴포넌트는 배출량 데이터를 카테고리별로 테이블에 표시하고, 사용자가 데이터를 추가, 수정 삭제할 수 있도록 한다. 각 카테고리별로 컬럼 구성이 다르며, 데이터 형식과 표시 방식이 달라진다. 또, 일부 카테고리에서 사용이 불가능한 기능(예: 수정, 삭제)도 있다.

- 복잡성 요인
    - 각 카테고리에 따라 컬럼 구성, 버튼 노출, 값 렌더링 방식이 다르게 동작함
    - 툴팁, 날짜 포맷, 수치 단위 등에 대한 시각적 처리 로직이 많음
    - 데이터 요청에 대한 SuspensQuery, 페이지네이션 등 비동기 로직이 존재
    - 다수의 상태가 상호작용하며 관리됨
- 리팩토링 필요성
    - UI 조건 분기가 많아 향후 카테고리 추가나 UI 변경 시 유지보수가 어려움
    - 카테고리별 컬럼 정의가 길고 반복적이며, 공통화가 부족해 가독성이 떨어짐
    - 현재 테스트가 부재하거나 부족해 코드 변경 시 사이드 이펙트 가능성이 높음
- 테스트 포인트
    - 각 카테고리별로 컬럼이 올바르게 렌더링되는지 확인
    - 카테고리에 따라 "추가", "수정", "삭제" 버튼이 노출/비활성화 되는지 확인
    - 특정 데이터를 렌더링할 때 배출계수 툴팁이 올바르게 표시되는지 검증
    - 데이터 추가/삭제 시 다이얼로그 및 스낵바 메시지가 정상적으로 동작하는지 확인

### 배출량 추가 폼 컴포넌트

이 컴포넌트는 배출량을 추가하거나 수정하는 폼 컴포넌트이다. 사용자가 선택한 카테고리에 따라 입력 항목이 달라지며, 기본 정보(사업장, 제품, 날짜 등) 외에도 각 항목의 단위를 입력하거나, 카테고리의 특수한 값을 입력해야 하는 경우도 있다.

- 복잡성 요인
    - 선택한 카테고리에 따라 입력해야 하는 필드가 달라진다.
    - 비동기 데이터가 다수로 처리된다.
    - 동적 필드에 대한 유효성 검사를 수행해야 해서 카테고리 또는 입력한 값에 따라 유효성 검사 로직이 달라진다.
- 리팩토링 필요성
    - 조건 분기 로직이 뷰와 섞여 있어 가독성 저하
    - 기능 추가/수정 시 사이드 이펙트 발생 가능성 높음
    - 테스트 부재로 인해 수동 테스트에 의존하고 있는데, 카테고리가 많아질수록 테스트해야 하는 경우의 수가 늘어난다.
- 테스트 포인트
    - 각 카테고리별로 필드가 올바르게 노출/비노출되는지 확인
    - 입력한 필드에 따라 조건부 필드가 정상 로딩되고 폼이 갱신되는지 확인
    - 유효성 검사 조건이 상황에 맞게 적용되는지 확인
    - 기존 데이터를 수정할 때 초기값이 잘 매핑되어 있는지 확인

## 계획

- 1주차: 테스트 환경 설정 및 간단한 유닛/통합 테스트 작성
- 2주차: 유닛/통합 테스트 보완 및 테스트 구체화
- 3주차: 유닛/통합 테스트로 커버되지 않는 부분에 대해 통합 테스트 및 e2e 테스트 작성
- 4주차: 컴포넌트 리팩터링
- 5주차: 성과 확인 및 산출물 작성